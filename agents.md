```mermaid
graph TD
    subgraph Agents
        A[**LLMService**] -->|Delegates tasks| B[SecurityService]
        A -->|Delegates tasks| C[UserService]
        A -->|Delegates tasks| D[DBService]
        C -->|Validates user data and processes requests| A
        B -->|Blocks unsafe requests| A
        D -->|Provides contextual data| A
    end

    subgraph User Services
        C -->|Interacts with user-specific database| E[User DB]
    end

    subgraph DB Services
        D -->|Interacts with vector-graph database| F[Vector-Graph DB]
    end

    subgraph User Interaction
        U[User Input] -->|Queries| A
        A -->|Processed response| U
    end
```

### Обновление архитектуры:
1. **LLMService**:
   - Центральный агент, маршрутизирующий запросы.
2. **SecurityService [предварительный вариант]**:
   - Проверяет запросы пользователя на безопасность и блокирует подозрительные инструкции. 
3. **UserService**:
   - Работает с пользовательскими данными, валидирует и сохраняет их в **User DB**.
   - Выполняет анализ запросов пользователя, связанных с его историей или текущими данными.
4. **DBService**:
   - Подключается к графовой базе данных (**Graph DB**) для извлечения информации, связанной с контекстом или сложными зависимостями.
   - Предоставляет результаты запросов для формирования ответов.
5. **Базы данных**:
   - **User DB**: Хранит пользовательские данные (например, историю показаний).
   - **Graph DB**: Используется для обработки сложных запросов и обеспечения контекста.

---

### Пример сценария:
1. Пользователь запрашивает: _"Какие были последние показания горячей воды?"_
   - **LLMService** идентифицирует запрос как относящийся к пользовательским данным и отправляет его в **UserService**.
   - **UserService** проверяет данные в своей базе и возвращает ответ через **LLMService**.

2. Пользователь задаёт контекстный вопрос: _"Сколько воды я использовал за последний год?"_
   - **LLMService** делегирует запрос к **DBService**, который выполняет вычисления на основе графовой базы данных.
   - Результат передаётся обратно через **LLMService**.

---

### Данная архитектура подчёркивает:
1. Разделение обязанностей:
   - **UserService** и **DBService** обрабатывают строго свои области (пользовательские данные vs. графовые контексты).
2. Модульность:
   - У каждого сервиса своя база, что упрощает тестирование и масштабирование.